window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var n,t=(this.document||this.ownerDocument).querySelectorAll(e),i=this;do{for(n=t.length;0<=--n&&t.item(n)!==i;);}while(n<0&&(i=i.parentElement));return i}),window.Vermin={config:{enableHoneypot:!0,enableTimer:!0,enableActionSwitch:!0,actionSwitchAttr:"data-action",honeypotName:"favorite_address",timerDelay:2e3,onDeny:null},initialTimestamp:Date.now(),init:function(e){if("object"==typeof e)for(key in e)if(void 0!==Vermin.config[key]){var n="Invalid configuration for key '%s': a %s is expected. This configuration has been ignored.";switch(key){case"enableHoneypot":case"enableTimer":case"enableActionSwitch":if(!!e[key]==e[key])break;Vermin.console("warn",n,[key,"boolean"]);continue;case"actionSwitchAttr":case"honeypotName":if("string"==typeof e[key])break;Vermin.console("warn",n,[key,"string"]);continue;case"timerDelay":if("number"==typeof e[key])break;Vermin.console("warn",n,[key,"number"]);continue;case"onDeny":if("function"==typeof e[key])break;Vermin.console("warn",n,[key,"function"]);continue}Vermin.config[key]=e[key]}else Vermin.console("warn","Unknown configuration key: '%s'. This configuration has been ignored.",[key]);Vermin.apply()},apply:function(){var e,n=document.querySelectorAll("form:not([vermin])");for(e=0;e<n.length;e++)n[e].setAttribute("vermin","on"),n[e].addEventListener("submit",Vermin.screen),n[e].addEventListener("focus",Vermin.actionSwitchListener,!0),Vermin.insertHoneypot(n[e])},actionSwitchListener:function(e){if(Vermin.config.enableActionSwitch&&-1!=["input","textarea","select"].indexOf(e.target.tagName.toLowerCase())){var n=e.target.closest("form");n.hasAttribute(Vermin.config.actionSwitchAttr)&&(n.setAttribute("action",n.getAttribute(Vermin.config.actionSwitchAttr)),n.removeEventListener("focus",Vermin.actionSwitchListener))}},insertHoneypot:function(e){var n=Vermin.buildNode(Vermin.sprintf('<div class="vermin-verification-field" style="position: fixed; top: -100%; left: -100%; width: 0; height: 0; padding: 0; margin: 0; opacity: 0; visibility: hidden; pointer-events: none;"><label>%s</label><input type="text" name="%s" autocomplete="new-password"></div>"',[Vermin.config.honeypotName,Vermin.config.honeypotName]));e.appendChild(n)},screen:function(e){if(Vermin.config.enableTimer&&Date.now()-Vermin.initialTimestamp<Vermin.config.timerDelay)return Vermin.deny(e,"timer");if(Vermin.config.enableActionSwitch&&e.target.hasAttribute(Vermin.config.actionSwitchAttr)&&e.target.getAttribute("action")!=e.target.getAttribute(Vermin.config.actionSwitchAttr))return Vermin.deny(e,"actionSwitch");if(Vermin.config.enableHoneypot&&e.target.querySelector(Vermin.sprintf('input[name="%s"]',[Vermin.config.honeypotName])).value.length)return Vermin.deny(e,"honeypot");var n=e.target.querySelector(Vermin.sprintf('input[name="%s"]',[Vermin.config.honeypotName]));n.parentNode.removeChild(n),e.target.dispatchEvent(new CustomEvent("vermin-success",{detail:{event:e}}))},deny:function(e,n){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t={timer:"Please wait a few seconds and submit the form again.",actionSwitch:"Please click on one of the form's input and submit the form again.",honeypot:Vermin.sprintf("Please empty the honeypot field (%s) and submit the form again.",[Vermin.config.honeypotName])}[n];if(Vermin.config.onDeny)Vermin.config.onDeny(e,n,t);else{var i=Vermin.buildNode(Vermin.sprintf('<div class="vermin-error-message" style="position: fixed; top: 0; left: 0; right: 0; width: 600px; max-width: 90%; padding: 12px 16px; margin: 30px auto; font-size: 14px; font-weight: 600; color: white; background-color: #e23a36; border-radius: 3px; box-shadow: 0 7px 10px rgba(0, 0, 0, .1); cursor: pointer; -webkit-font-smoothing: antialiased;">%s</div>',[t]));document.body.appendChild(i),i.addEventListener("click",function(){i.parentNode.removeChild(i)}),setTimeout(function(){i&&i.parentNode&&i.parentNode.removeChild(i)},7500)}},sprintf:function(e,n){var t=e;for(index in n="object"!=typeof n?[]:n)t=t.replace("%s",n[index]);return t},buildNode:function(e){var n=document.createElement("div");return n.innerHTML=e,n.firstChild},console:function(e,n,t){console[e]("[Vermin.js] "+Vermin.sprintf(n,t)+" For more information, please refer to the documentation: https://github.com/EmilePerron/vermin.js")}};
